bedroom:
  ##############
  sensor: #–°–µ–Ω—Å—Ç–æ—Ä—ã
    ##############
    - platform: template
      sensors:
        bedroom_main_temperature:
          friendly_name: "–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≤ —Å–ø–∞–ª—å–Ω–µ"
          unit_of_measurement: "¬∞C"
          icon_template: mdi:thermometer
          value_template: >-
            {{((states('sensor.cleargrass_air_temperature')|float+ states('sensor.0x00158d00063dd379_temperature')|float)/2)|round(1)}}
          attribute_templates:
            chest_temp: "{{states('sensor.cleargrass_air_temperature')|float}}"
            wall_temp: "{{states('sensor.0x00158d00063dd379_temperature')|float}}"

  ##############
  binary_sensor:
    ##############
    - platform: template
      sensors:
        head_stuck:
          friendly_name: "–¢–µ—Ä–º–æ–≥–æ–ª–æ–≤–∞ –∑–∞–ª–∏–ø–ª–∞"
          delay_on:
            hours: 1
          value_template: "{{ is_state('sensor.0x842e14fffe5a3002_position', '100') }}"
          attribute_templates:
            position: "{{states('sensor.0x842e14fffe5a3002_position')}}"
  ##############
  automation: #–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏
    ##############

    - alias: " turnoff_heating_bedroom_if_window_open" # –í—ã–∫–ª—á–∞–µ–º –æ—Ç–æ–ø–ª–µ–Ω–∏–µ –µ—Å–ª–∏ –æ–∫–Ω–æ –æ—Ç–∫—Ä—ã—Ç–æ
      trigger:
        platform: state
        entity_id: binary_sensor.0x00158d0006c415b5_contact
        to: "on"
        for:
          minutes: 1
      action:
        - service: climate.set_hvac_mode
          target:
            entity_id: climate.0x842e14fffe5a3002 #–¢–µ—Ä–º–æ–≥–æ–ª–æ–≤–∞ –≤ —Å–ø–∞–ª—å–Ω–µ
          data:
            hvac_mode: "off"

    - alias: " turnon_heating_bedroom_if_window_close" # –í–∫–ª—á–∞–µ–º –æ—Ç–æ–ø–ª–µ–Ω–∏–µ –µ—Å–ª–∏ –æ–∫–Ω–æ –∑–∞–∫—Ä—ã—Ç–æ
      trigger:
        platform: state
        entity_id: binary_sensor.0x00158d0006c415b5_contact
        to: "off"
        for:
          minutes: 1
      action:
        - service: climate.set_hvac_mode
          target:
            entity_id: climate.0x842e14fffe5a3002 #–¢–µ—Ä–º–æ–≥–æ–ª–æ–≤–∞ –≤ —Å–ø–∞–ª—å–Ω–µ
          data:
            hvac_mode: "auto"

    # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–≤–µ—Ç–æ–º
    - alias: "switchButton1"
      trigger:
        platform: state
        entity_id: sensor.0x04cf8cdf3c7d3864_action
        to: "button_1_single"
      action:
        - service: script.light_bedroom_ch_1

    - alias: "switchButton2" #–í–∫–ª—é—á–∞–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∫–æ–Ω–¥–∏—Ü–∏–æ–Ω–µ—Ä
      trigger:
        platform: state
        entity_id: sensor.0x04cf8cdf3c7d3864_action
        to: "button_2_single"
      action:
        - service: switch.toggle
          data:
            entity_id: switch.air_conditioner_switch

    - alias: "switchButton3"
      trigger:
        platform: state
        entity_id: sensor.0x04cf8cdf3c7d3864_action
        to: "button_3_single"
      action:
        - service: script.light_bedroom_ch_2

    - alias: "switchButton4"
      trigger:
        platform: state
        entity_id: sensor.0x04cf8cdf3c7d3864_action
        to: "button_4_single"
      action:
        - service: input_boolean.toggle
          data:
            entity_id: input_boolean.doorbell_input_boolean

    - alias: "switchButton5"
      trigger:
        platform: state
        entity_id: sensor.0x04cf8cdf3c7d3864_action
        to: "button_5_single"
      action:
        - service: script.light_bedroom_ch_3

    - alias: "switchButton6"
      trigger:
        platform: state
        entity_id: sensor.0x04cf8cdf3c7d3864_action
        to: "button_6_single"
      action:
        - service: switch.toggle
          data:
            entity_id: switch.0xec1bbdfffe0e4df8_right

    - alias: heatTemperatureCalibration ### –ö–∞–ª–∏–±—Ä–æ–≤–∫–∞ –±–∞—Ç–∞—Ä–µ–∏
      trigger:
        - platform: time_pattern
          minutes: "/5"
      action:
        - service: mqtt.publish
          data_template:
            topic: "zigbee2mqtt/BedroomThermostat01/set/local_temperature_calibration"
            payload_template: >-
              {{(state_attr('climate.0x842e14fffe5a3002','local_temperature_calibration')|float -
                state_attr('climate.0x842e14fffe5a3002', 'current_temperature')|float +
                states('sensor.bedroom_main_temperature')|float + 128)|round(1,'half')}}

    - alias: "CheckingHang" # –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∞–Ω–∏—è —Ç–µ—Ä–º–æ–≥–æ–ª–æ–≤—ã
      trigger:
        platform: state
        entity_id: binary_sensor.head_stuck
        to: "on"
      action:
        #- service: climate.set_hvac_mode
        #target:
        #entity_id: climate.0x842e14fffe5a3002 #–¢–µ—Ä–º–æ–≥–æ–ª–æ–≤–∞ –≤ —Å–ø–∞–ª—å–Ω–µ
        #data:
        #hvac_mode: "off"
        #- delay: 60
        - service: climate.set_hvac_mode
          target:
            entity_id: climate.0x842e14fffe5a3002 #–¢–µ—Ä–º–æ–≥–æ–ª–æ–≤–∞ –≤ —Å–ø–∞–ª—å–Ω–µ
          data:
            hvac_mode: "heat"
        - delay: 60
        - service: climate.set_hvac_mode
          target:
            entity_id: climate.0x842e14fffe5a3002 #–¢–µ—Ä–º–æ–≥–æ–ª–æ–≤–∞ –≤ —Å–ø–∞–ª—å–Ω–µ
          data:
            hvac_mode: "auto"

    # –°–æ–æ–±—â–∞–µ–º —á—Ç–æ –±–∞—Ç–∞—Ä–µ–π–∫–∏ –≤ –≥–æ–ª–≤–µ –Ω–∞–¥–æ –∑–∞–º–µ–Ω–∏—Ç—å
    - alias: "replacingBatteriesInHead"
      trigger:
        platform: state
        entity_id: binary_sensor.0x842e14fffe5a3002_battery_low
        to: "on"
        for:
          minutes: 60
      action:
        - service: notify.telegram
          data:
            message: |
              ‚ùé üîã üë≥
              –£–∂–µ —á–∞—Å –≤–∏—Å–∏—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–µ–Ω–∏–µ –æ –Ω–∏–∑–∫–æ–º –∑–∞—Ä—è–¥–µ –±–∞—Ç–∞—Ä–µ–µ–∫ –≤ –≥–æ–ª–æ–≤–µ –±–∞—Ç–∞—Ä–µ–∏ —Å–ø–∞–ª—å–Ω–∏, –∫—É–ø–∏ 2—à—Ç –ê–ê –∏ –∑–∞–º–µ–Ω–∏.

    #    ### –ù–∞ –Ω–æ—á—å –¥–µ–ª–∞–µ–º –ø—Ä–æ—Ö–ª–∞–¥–Ω–µ–µ
    #    - alias: "nightIsColder"
    #      trigger:
    #        - platform: time
    #          at:
    #            - "20:00:00"
    #            - "21:30:00"
    #      action:
    #        - service: climate.set_temperature
    #          data_template:
    #            entity_id: climate.0x842e14fffe5a3002
    #            temperature: >-
    #              {{ (state_attr('climate.0x842e14fffe5a3002', 'temperature') | float - 0.5) }}
    #        - delay: 30
    #        - service: climate.set_temperature
    #          data_template:
    #            entity_id: climate.gostinaia
    #            temperature: >-
    #              {{ (state_attr('climate.gostinaia', 'temperature') | float - 0.5) }}
    #    # –° —É—Ç—Ä–∞ –ø–æ—Ç–µ–ø–ª–µ–µ
    #    - alias: "warmerDuringDay"
    #      trigger:
    #        - platform: time
    #          at:
    #            - "6:00:00"
    #            - "8:00:00"
    #      action:
    #        - service: climate.set_temperature
    #          data_template:
    #            entity_id: climate.0x842e14fffe5a3002
    #            temperature: >-
    #              {{ (state_attr('climate.0x842e14fffe5a3002', 'temperature') | float + 0.5) }}
    #        - delay: 30
    #        - service: climate.set_temperature
    #          data_template:
    #            entity_id: climate.gostinaia
    #            temperature: >-
    #              {{ (state_attr('climate.gostinaia', 'temperature') | float + 0.5) }}

    - alias: "bedroomIsOnFire" #–í—ã—Å–æ–∫–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –¥–æ–º–∞
      trigger:
        - above: "40"
          platform: numeric_state
          entity_id: sensor.cleargrass_air_temperature
          for:
            minutes: 1
      action:
        service: notify.telegram
        data_template:
          title: "–ì–æ—Ä–∏–º?"
          message: "–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≤ —Å–ø–∞–ª—å–Ω–µ –±–æ–ª—å—à–µ 40!!!"
